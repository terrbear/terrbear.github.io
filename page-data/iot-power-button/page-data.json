{"componentChunkName":"component---src-templates-blog-post-js","path":"/iot-power-button/","result":{"data":{"site":{"siteMetadata":{"title":"terrbear dot org"}},"markdownRemark":{"id":"641199f8-ca0b-5495-9bd2-1605d630a280","excerpt":"I recently bought a Pixelbook, \nwhich is great for lots of things, but not coding. I knew this at purchase time, however, \nso I just planned on SSH’ing wherever I wanted to work. Most of my home projects live on a personal EC2 instance I’ve set up.\nIt lives in an autoscale group whose size is usually 0, so I’m not paying for\nthe machine when I’m not using it. One nit with this setup, however, was that I had to sign into the AWS console to turn on the machine, so\nI took my no-longer-used IoT button (see here) \nand plumbed it such that it behaves like a power button for my EC2 instance. I’ve set…","html":"<p>I recently bought a <a href=\"https://store.google.com/us/product/google_pixelbook\">Pixelbook</a>,\nwhich is great for lots of things, but not coding. I knew this at purchase time, however,\nso I just planned on SSH’ing wherever I wanted to work.</p>\n<p>Most of my home projects live on a personal EC2 instance I’ve set up.\nIt lives in an autoscale group whose size is usually 0, so I’m not paying for\nthe machine when I’m not using it.</p>\n<p>One nit with this setup, however, was that I had to sign into the AWS console to turn on the machine, so\nI took my no-longer-used IoT button (<a href=\"http://terrbear.org/scala/iot/ios/lazy/2016/05/23/amazon-iot-button.html\">see here</a>)\nand plumbed it such that it behaves like a power button for my EC2 instance.</p>\n<p>I’ve set all of this up at a <a href=\"https://github.com/terrbear/boxomatic\">GitHub repo</a> so you can copy it and do the same.</p>\n<p>First, the high level workflow:</p>\n<ol>\n<li>Push IoT Button</li>\n<li>Trigger <a href=\"https://aws.amazon.com/lambda/\">Lambda</a></li>\n<li>Set ASG desired size to (ASG size == 0 ? 1 : 0)</li>\n<li>Bootstrap from <a href=\"https://www.ansible.com/\">Ansible</a></li>\n</ol>\n<h2>AWS Setup</h2>\n<blockquote>\n<p>Note: You can achieve something similar with a single EC2 instance and suspend\nit between uses. That said, I’m suspicious of any EC2 host that’s been running\naround for more than a month, so I prefer having a brand new host each time.</p>\n</blockquote>\n<p>The first step to getting this working is to pick an EC2 instance in a launch\nconfig and create an autoscale group around it. This setup expects an <a href=\"https://www.ubuntu.com/\">Ubuntu</a>\ninstance. If you go with something else, you’ll need to tweak a lot more to\nfit your needs.</p>\n<p>The instance will need permissions to access an S3 bucket where you’re keeping\nthe Ansible config (explained below).</p>\n<p>I’m not going to go into VPC setup here, but you want to use a VPC subnet that\nhas public internet access, and be sure to grant the instance a public IP. If\nyou don’t do that, you’ll be unable to access your instance directly.</p>\n<p>Here’s the first part where things get fun, the user data for the launch config\n(available under Advanced Details):</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token shebang important\">#!/bin/bash -xev</span>\n\n<span class=\"token function\">apt-get</span> update\n<span class=\"token function\">apt-get</span> <span class=\"token function\">install</span> -y python-pip python-dev libffi-dev libssl-dev\n\npip <span class=\"token function\">install</span> s3cmd\npip <span class=\"token function\">install</span> markupsafe\n\n<span class=\"token function\">mkdir</span> /root/ansible\n\ns3cmd get --recursive s3://YOUR-BUCKET /root/ansible\npip <span class=\"token function\">install</span> ansible\npip <span class=\"token function\">install</span> setuptools --upgrade\n\n<span class=\"token function\">sleep</span> <span class=\"token number\">30</span>\n\n<span class=\"token builtin class-name\">cd</span> /root/ansible <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">rm</span> ansible.cfg <span class=\"token operator\">&amp;&amp;</span> ansible-galaxy <span class=\"token function\">install</span> -r deps.txt <span class=\"token operator\">></span> /bootstrap.out\n\n<span class=\"token function\">sleep</span> <span class=\"token number\">10</span>\n\n<span class=\"token builtin class-name\">cd</span> /root/ansible <span class=\"token operator\">&amp;&amp;</span> ansible-playbook -i production -c <span class=\"token builtin class-name\">local</span> box.yml <span class=\"token operator\">>></span> /bootstrap.out</code></pre></div>\n<p>The user data is responsible for installing the bare minimum and grabbing things\nfrom S3. There are some seemingly arbitrary sleeps in there because occasionally\nI’ve had the s3cmd still finishing up but Ansible starts running anyway - ¯\\<em>(ツ)</em>/¯</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb87d73926fd7cdfbeef0c584b74819d/40a97/advanced-details.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAAxklEQVQY03WRWw6DIBRE3f+GuoCuoH/91K9qBKGggC/sCcTEGHqS3hDDzNyhlfdea62Umud5T6zruizLdoGPR4mKX4yRaYxpmiaEwKzrGjsppRCi73vc/4ozJHOJ2GEYuq4bx5GlpgSO+U6OKYgzbIhF27aI0TjnQoIDLtQpiLE0CZKttRyY0wlGNsHh2r+6ZsYEJVk7t2XmtySTC7zdtseCmExK8rZEqYQ+YWf0t8J3Md2K/8qyH84Hqb7Pt3685EcYoxXFfnwu0cr1ulxiAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Advanced Details\"\n        title=\"Advanced Details\"\n        src=\"/static/fb87d73926fd7cdfbeef0c584b74819d/fcda8/advanced-details.png\"\n        srcset=\"/static/fb87d73926fd7cdfbeef0c584b74819d/12f09/advanced-details.png 148w,\n/static/fb87d73926fd7cdfbeef0c584b74819d/e4a3f/advanced-details.png 295w,\n/static/fb87d73926fd7cdfbeef0c584b74819d/fcda8/advanced-details.png 590w,\n/static/fb87d73926fd7cdfbeef0c584b74819d/efc66/advanced-details.png 885w,\n/static/fb87d73926fd7cdfbeef0c584b74819d/c83ae/advanced-details.png 1180w,\n/static/fb87d73926fd7cdfbeef0c584b74819d/40a97/advanced-details.png 1911w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Don’t attach any extra storage to the instance at this point - the default\nephemeral storage works fine for what we’re doing.</p>\n<p>You’ll want to allow TCP access over port 22 to your IP. If you don’t care,\nyou can use 0.0.0.0/0 for your source, though I’d suggest just doing a quick\n<code class=\"language-text\">curl ifconfig.co</code> and using that instead.</p>\n<p>Go create an autoscale group using the launch config you just created, and\nkeep it isolated to a single availability zone. It doesn’t matter which,\nbut needs to be just one.</p>\n<p>Then, create an EBS volume in the same availability zone as your autoscale group.\nThis will be where your home directory and your code will live. Keep in mind that\nyou will pay for EBS capacity even if you’re not using it.</p>\n<p>Lastly, you’ll want to create an AWS account with API access that can:</p>\n<ol>\n<li>Create Route53 records in whatever zone you want your DNS entry to be</li>\n<li>Attach EBS volumes to EC2 instances</li>\n</ol>\n<h2>Bootstrapping With Ansible</h2>\n<p>In an effort to be cheap/simple, I’ve avoided better tools like <a href=\"https://aws.amazon.com/opsworks/\">OpsWorks</a>\nor <a href=\"https://www.ansible.com/products/tower\">Ansible Tower</a> and gone with simply\nhosting Ansible in S3.</p>\n<p>The host boots up, pulls from S3 all the ansible provisioning info, runs it,\nand then I can SSH in happily.</p>\n<p>I have more things that happen in my own repository, but the basic necessities are:</p>\n<ol>\n<li>vim</li>\n<li>set a Route53 entry so I don’t have to find the IP</li>\n<li>attach and mount an EBS volume so my workspace persists</li>\n<li>install a few things that I figure everyone wants</li>\n</ol>\n<p>You’ll need to walk through the git repo and replace a few things for this to\nwork for you (eg, your AWS keys will need to be in the playbook). This is described\nin the <a href=\"https://github.com/terrbear/boxomatic/blob/master/README.markdown\">README</a> in the git repo.</p>\n<p><em>Be sure to publish your Ansible files before proceeding!</em></p>\n<p>The EC2 instance needs to be able to pull the Ansible data from S3, and then\nAnsible needs to be able to create records in Route53 and attach EBS volumes.</p>\n<p>I didn’t figure out how to get the AWS Ansible calls to rely just on the native\nIAM role, so I have a separate account with AWS API credentials that can handle\nthe EBS and Route53 tasks (described above).</p>\n<blockquote>\n<p>Note: There’s a Vagrantfile in the ansible/ directory in the git repo that\nallows for faster testing of Ansible changes than waiting on AWS to boot\nan instance each time.</p>\n</blockquote>\n<p>Once your host is up, you can verify it worked by checking out <code class=\"language-text\">/bootstrap.out</code>, eg:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- downloading role &#39;nodejs&#39;, owned by geerlingguy\n- downloading role from https://github.com/geerlingguy/ansible-role-nodejs/archive/4.2.0.tar.gz\n- extracting geerlingguy.nodejs to /root/.ansible/roles/geerlingguy.nodejs\n- geerlingguy.nodejs (4.2.0) was installed successfully\n\nPLAY [box] ***************************************************************\n\nTASK [Gathering Facts] *********************************************************\nok: [127.0.0.1]\n\nTASK [common : apt get update] *************************************************\nchanged: [127.0.0.1]\n\nTASK [common : install useful stuff] *******************************************\nchanged: [127.0.0.1] =&gt; (item=[u&#39;ntp&#39;, u&#39;vim&#39;, u&#39;openjdk-8-jdk-headless&#39;, u&#39;ruby&#39;, u&#39;ruby-dev&#39;, u&#39;ruby-all-dev&#39;, u&#39;ruby-bundler&#39;, u&#39;postgresql&#39;, u&#39;libpq-dev&#39;, u&#39;pkg-config&#39;, u&#39;ruby-pkg-config&#39;, u&#39;libmagickwand-dev&#39;, u&#39;imagemagick&#39;, u&#39;libssl-dev&#39;, u&#39;libffi-dev&#39;, u&#39;dstat&#39;, u&#39;htop&#39;, u&#39;direnv&#39;, u&#39;python-psycopg2&#39;, u&#39;awscli&#39;, u&#39;jq&#39;])\n\nTASK [aws : boto] **************************************************************\nchanged: [127.0.0.1]\n\nTASK [ebs : who am i] **********************************************************\nok: [127.0.0.1]\n\nTASK [ebs : ebs vol] ***********************************************************\nchanged: [127.0.0.1]\n\nTASK [ebs : name me] ***********************************************************\nchanged: [127.0.0.1]\n\n&lt;snip&gt;\n\nPLAY RECAP *********************************************************************\n127.0.0.1                  : ok=23   changed=18   unreachable=0    failed=0   </code></pre></div>\n<h2>Boxomatic: The Lambda</h2>\n<p>This gets triggered when the button is pushed and is responsible for adjusting the autoscale\ngroup size. The code itself is pretty short:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">AWS</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aws-sdk\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> Promise <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bluebird\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> autoscaling <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">AWS<span class=\"token punctuation\">.</span>AutoScaling</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">ASG_NAME</span> <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">ASG_NAME</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">checkCapacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    AutoScalingGroupNames<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">ASG_NAME</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> autoscaling<span class=\"token punctuation\">.</span><span class=\"token function\">describeAutoScalingGroups</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"data back: \"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">const</span> asg <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>AutoScalingGroups<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span> asg<span class=\"token punctuation\">.</span>Instances<span class=\"token punctuation\">.</span>length <span class=\"token operator\">+</span> asg<span class=\"token punctuation\">.</span>DesiredCapacity<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">handler</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> params <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    AutoScalingGroupName<span class=\"token operator\">:</span> <span class=\"token constant\">ASG_NAME</span><span class=\"token punctuation\">,</span> \n    DesiredCapacity<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> \n    HonorCooldown<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">checkCapacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">size</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>size <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      params<span class=\"token punctuation\">.</span>DesiredCapacity <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    autoscaling<span class=\"token punctuation\">.</span><span class=\"token function\">setDesiredCapacity</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">.</span>stack<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"gotime\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nexports<span class=\"token punctuation\">.</span>handler <span class=\"token operator\">=</span> handler<span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>Note: When creating this Lambda in your account, it’s easiest to\ncreate a lambda named ‘boxomatic’ that is javascript and blank, and then\nrun the deploy.sh script. Otherwise, just npm i and zip it and upload it.</p>\n</blockquote>\n<p>You’ll need to give the lambda permission to read and modify autoscaling groups.\nI just used the stock <code class=\"language-text\">arn:aws:iam::aws:policy/AutoScalingFullAccess</code> policy.</p>\n<p>When creating the Lambda, be sure to set the environment variable <code class=\"language-text\">ASG_NAME</code> to\nwhatever you named your autoscale group.</p>\n<p>Now push the button and watch everything come to life!</p>\n<h2>Cost</h2>\n<p>Even when I get ambitious and turn on the machine on days I don’t use it, my costs\nhave yet to exceed $40 in a month. I use this mostly on weekends. Here’s my bill\nfor August as of 28Aug08:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/133c78179497aa49636ae9131b80eead/58bb7/cost.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsSAAALEgHS3X78AAABcElEQVQoz42SO0/CUBSA+yf9Aw4mbsa4O6iTiYuJo4MxoiaKhoCbBHQzBqG2lGpbLAW0LfRBoZT7qKdFtPIwfsPpfeQ7595zy5TL5VoMz/OCIECEMcdxsiybpqknMAxDVVU5pt1uI4QYlmXHMpjValWIPhzPVSRJfmtoakNrJlAURRRFSZIgF8aYcafouY439Aa473nYh4ltO47rRNi23YuBmmEMEyahFELQFez82uHJ1W7RcH00WZ4DQycQQmBuWfVKemkgXVtO/+C+tXEpklilCX7k7xEhGGL6bq9QOkIk1LRGGOLNnFJ4saLdedWn5dTtdun15qOlZ7I55Hv7xWaWM/4h0+jYz0p+63ynM4hWnrTe8jFveqNF12bodL/I2WNzJSWsX9RWT4WHurOo7Ey348ZAhGqiPvAC/EerI/ndHRJCMUZjjYZfbR8ngq3Z7DgmkjOs7vlBt9OBpycTEMYjhCGS34AZBIFlWfA3gfwJ0lWjNeIjIWkAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"August Bill\"\n        title=\"August Bill\"\n        src=\"/static/133c78179497aa49636ae9131b80eead/fcda8/cost.png\"\n        srcset=\"/static/133c78179497aa49636ae9131b80eead/12f09/cost.png 148w,\n/static/133c78179497aa49636ae9131b80eead/e4a3f/cost.png 295w,\n/static/133c78179497aa49636ae9131b80eead/fcda8/cost.png 590w,\n/static/133c78179497aa49636ae9131b80eead/efc66/cost.png 885w,\n/static/133c78179497aa49636ae9131b80eead/58bb7/cost.png 985w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Safety Measures</h2>\n<p>I have two scheduled actions for my autoscale group that prevent me from\naccidentally paying for a month’s worth of instance time. At midnight(ish) every\nnight, the autoscale group sets desired and max capacity to 0, which shuts down\nthe host if it’s running.</p>\n<p>Shortly after, I set the max capacity back to 1, so the next time I push the button,\nthe host comes on (if you set desired > max, AWS errors).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5360357317b6e8d25b487dc6a57cc455/93582/scheduled-actions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.351351351351354%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAAsSAAALEgHS3X78AAAAy0lEQVQY032PzXKEIBCEef+386CUrmb9W0EICoy4sKubdLK3HDKHr4qeLrqHEdHwO33fK6WmaZJSnuf59e/AEEJgy7IIIbz31tp1XYl8jDGlhE/xdM69dWMMbMho2xZEDFYMi6qqEDvPahzHuq7fFWDtuo5z3jQNL/ilvuR5nmVZURTwl2WptWbhHgepm24EP324DuKjv7U3cR2FNFa7DewnpSzNqwPhMT7IxdEeGdqjpfcU9h3HgEQbbRv4eD6hHMeR0uP15+bXj/ANBRIXg/WSh6AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Scheduled Actions\"\n        title=\"Scheduled Actions\"\n        src=\"/static/5360357317b6e8d25b487dc6a57cc455/fcda8/scheduled-actions.png\"\n        srcset=\"/static/5360357317b6e8d25b487dc6a57cc455/12f09/scheduled-actions.png 148w,\n/static/5360357317b6e8d25b487dc6a57cc455/e4a3f/scheduled-actions.png 295w,\n/static/5360357317b6e8d25b487dc6a57cc455/fcda8/scheduled-actions.png 590w,\n/static/5360357317b6e8d25b487dc6a57cc455/efc66/scheduled-actions.png 885w,\n/static/5360357317b6e8d25b487dc6a57cc455/c83ae/scheduled-actions.png 1180w,\n/static/5360357317b6e8d25b487dc6a57cc455/93582/scheduled-actions.png 1524w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Troubleshooting</h2>\n<p>If you’re first trying to get this running and nothing seems to happen when you push\nthe button, first trigger the lambda manually (the hello world payload is fine) and watch\nthe <a href=\"https://aws.amazon.com/cloudwatch/\">Cloudwatch</a> logs associated with that run.\nIf that all looks good, go manually increase the desired capacity of your autoscale group\nand see what happens there.</p>\n<p>Ansible’s fun\n<a href=\"https://docs.ansible.com/ansible/devel/porting_guides/porting_guide_2.4.html#deprecated\">habit</a>\n<a href=\"https://docs.ansible.com/ansible/devel/porting_guides/porting_guide_2.5.html#deprecated\">of</a>\n<a href=\"https://docs.ansible.com/ansible/devel/porting_guides/porting_guide_2.7.html#deprecated\">deprecating</a>\n<a href=\"https://docs.ansible.com/ansible/devel/porting_guides/porting_guide_2.6.html#deprecated\">commands</a>\nmeans if you wait 2 years between pressing your button, you’ll have some commands that fail.\nWhen that happens, you can still access the host, you’ll just have to sign into the AWS console\nto get the public IP and SSH directly to that instead of whatever DNS you picked.</p>\n<p>Check <code class=\"language-text\">/bootstrap.out</code> and <code class=\"language-text\">/var/log/cloud-init-output.log</code> for clues.</p>","frontmatter":{"title":"AWS IoT EC2 Power Button","date":"August 26, 2018","description":null}}},"pageContext":{"slug":"/iot-power-button/","previous":{"fields":{"slug":"/dpkg-apt-s3-2017/"},"frontmatter":{"title":"Packaging dpkg for S3 in 2017"}},"next":null}}}